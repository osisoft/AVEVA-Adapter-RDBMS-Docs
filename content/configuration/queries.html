<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Queries </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Queries ">
    <meta name="generator" content="docfx 2.59.1.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../content/index.html" width="46">
                <img id="logo" src="../../content/main/shared-content/images/atlas_icon.png" height="46" width="46" alt="OSIsoft Edge System"> 
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="PIAdapterForRDBMSQueriesConfiguration">
<h1 id="queries">Queries</h1>

<p>Queries configuration contains a list of queries to run on the data source.</p>
<h2 id="configure-rdbms-queries">Configure RDBMS queries</h2>
<p>Complete the following steps to configure RDBMS queries. Use the <code>PUT</code> method in conjunction with the <code>http://localhost:5590/api/v1/configuration/&lt;ComponentId&gt;/Queries</code> REST endpoint to initialize the configuration.</p>
<ol>
<li><p>Using a text editor, create an empty text file.</p>
</li>
<li><p>Copy and paste an example configuration for RDBMS queries into the file.</p>
<p> For sample JSON, see <a href="#rdbms-queries-example">RDBMS queries example</a>.</p>
</li>
<li><p>Update the example JSON parameters for your environment.</p>
<p> For a table of all available parameters, see <a href="#rdbms-query-parameters">RDBMS query parameters</a>.</p>
</li>
<li><p>Save the file. For example, as <code>ConfigureQueries.json</code>.</p>
</li>
<li><p>Open a command line session. Change directory to the location of <code>ConfigureQueries.json</code>.</p>
</li>
<li><p>Enter the following cURL command (which uses the <code>PUT</code> method) to initialize the queries configuration.</p>
<pre><code class="lang-bash">curl -d &quot;@ConfigureQueries.json&quot; -H &quot;Content-Type: application/json&quot; -X PUT &quot;http://localhost:5590/api/v1/configuration/&lt;ComponentId&gt;/Queries&quot;
</code></pre><p> <strong>Notes:</strong></p>
<ul>
<li>If you installed the adapter to listen on a non-default port, update <code>5590</code> to the port number in use.</li>
<li>If you use a component Id other than <code>RDBMS1</code>, update the endpoint with your chosen component Id.
<br>
<br></li>
</ul>
</li>
</ol>
<h2 id="rdbms-query-schema">RDBMS query schema</h2>
<p>The full schema definition for the RDBMS query configuration is in the <code>RDBMS_Queries_schema.json</code> file located in one of the following folders:</p>
<p>Windows: <code>%ProgramFiles%\OSIsoft\Adapters\RDBMS\Schemas</code></p>
<p>Linux: <code>/opt/OSIsoft/Adapters/RDBMS/Schemas</code></p>
<h2 id="rdbms-query-parameters">RDBMS query parameters</h2>
<p>The following parameters are available to configure queries to be sent to the Open Database Connectivity (ODBC) driver. The supported query syntax depends on the ODBC driver you are using.
These queries are sent to the driver exactly as defined, and the adapter uses the driver response to collect data.</p>
<p>Refer to the documentation for your ODBC driver for supported query syntax.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>QueryString<sup></sup></td>
<td>Required</td>
<td><code>string</code></td>
<td>The SQL query to run.</td>
</tr>
<tr>
<td>Id</td>
<td>Required</td>
<td><code>string</code></td>
<td>String identifier of the query to be referenced by data selection items.</td>
</tr>
</tbody>
</table>
<p><sup> Within <code>QueryString</code>, you can use the placeholder values listed below to streamline query configuration. Delimit the placeholders with question marks. Placeholders include:<p>
<ul>
<li><code>?LST?</code>: Last Scan Time. This is a timestamp representing the time the adapter ran the last scan.</li>
<li><code>?ET?</code>: End Time. If the adapter is in a history recovery mode, this will be the <code>?ST?</code> value plus the RequestInterval specified in the data source configuration. For example, if <strong>RequestInterval</strong> is set to 1 hour, there will be an hour difference between <code>?ST?</code> and <code>?ET?</code>. If the adapter is not in history recovery mode, this will be replaced with the current time.</li>
<li><code>?ST?</code>: Start Time. If the adapter is in history recovery mode, this placeholder will be replaced by the StartTime specified in the history recovery configuration on the first scan. After the first scan during history recovery, this placeholder will be replaced by the timestamp of the last event collected.</li>
</ul>
<h2 id="rdbms-queries-example">RDBMS queries example</h2>
<pre><code class="lang-json">[
    {
        &quot;QueryId&quot;: &quot;Tank1&quot;,
        &quot;QueryString&quot;: &quot;SELECT TEMPERATURE, PRESSURE, VOLUME, SAMPLETIME FROM TANK1 WHERE SAMPLETIME &gt; ?LST? ORDER BY SAMPLETIME ASC&quot;
    },
    {
        &quot;QueryId&quot;: &quot;Tanks&quot;,
        &quot;QueryString&quot;: &quot;SELECT ASSET, TEMPERATURE, PRESSURE, VOLUME, SAMPLETIME FROM TANK1 WHERE SAMPLETIME &gt; ?LST? ORDER BY SAMPLETIME ASC&quot;
    }
]
</code></pre><h2 id="rest-urls">REST URLs</h2>
<table>
<thead>
<tr>
<th>Relative URL</th>
<th>HTTP verb</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>api/v1/configuration/<em>ComponentId</em>/Queries</td>
<td>GET</td>
<td>Gets all configured queries</td>
</tr>
<tr>
<td>api/v1/configuration/<em>ComponentId</em>/Queries</td>
<td>DELETE</td>
<td>Deletes all configured queries</td>
</tr>
<tr>
<td>api/v1/configuration/<em>ComponentId</em>/Queries</td>
<td>POST</td>
<td>Adds an array of queries or a single query. Fails if any query already exists</td>
</tr>
<tr>
<td>api/v1/configuration/<em>ComponentId</em>/Queries</td>
<td>PUT</td>
<td>Replaces all queries</td>
</tr>
<tr>
<td>api/v1/configuration/<em>ComponentId</em>/Queries/<em>id</em></td>
<td>GET</td>
<td>Gets configured query by <em>id</em></td>
</tr>
<tr>
<td>api/v1/configuration/<em>ComponentId</em>/Queries/<em>id</em></td>
<td>DELETE</td>
<td>Deletes configured query by <em>id</em></td>
</tr>
<tr>
<td>api/v1/configuration/<em>ComponentId</em>/Queries/<em>id</em></td>
<td>PUT</td>
<td>Replaces query by <em>id</em>. Fails if query does not exist</td>
</tr>
<tr>
<td>api/v1/configuration/<em>ComponentId</em>/Queries/<em>id</em></td>
<td>PATCH</td>
<td>Allows partial updating of configured query by <em>id</em></td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> Replace <em>ComponentId</em> with the Id of your adapter component.</p>
</sup></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/osisoft/PI-Adapter-RDBMS-Docs/blob/main/content/configuration/queries.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span><a href="https://www.osisoft.com/copyright/">© 2019 - 2021 OSIsoft, LLC. All rights reserved.</a></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
